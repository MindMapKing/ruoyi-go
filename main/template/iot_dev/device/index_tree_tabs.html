<!DOCTYPE html>
<html lang="zh">
<head>
    {{template "header" (OssUrl)}}
    <link href="{{OssUrl}}/resource/ajax/libs/jquery-layout/jquery.layout-latest.css" rel="stylesheet"/>
    <link href="{{OssUrl}}/resource/ajax/libs/jquery-ztree/3.5/css/metro/zTreeStyle.css" rel="stylesheet"/>
</head>
<body class="gray-bg">
<div class="ui-layout-west">
    <div class="box box-main">
        <div class="box-header">
            <div class="box-title">
                <i class="fa icon-grid"></i> 组织机构
            </div>
            <div class="box-tools pull-right">
                <a type="button" class="btn btn-box-tool" href="javascript:void(0)" onclick="dept()">
                    <i class="fa fa-edit"></i></a>
                <button type="button" class="btn btn-box-tool" id="btnExpand" title="展开" style="display:none;">
                    <i class="fa fa-chevron-up"></i></button>
                <button type="button" class="btn btn-box-tool" id="btnCollapse" title="折叠">
                    <i class="fa fa-chevron-down"></i></button>
                <button type="button" class="btn btn-box-tool" id="btnRefresh" title="刷新">
                    <i class="fa fa-refresh"></i></button>
            </div>
        </div>
        <div class="ui-layout-content">
            <div id="tree" class="ztree"></div>
        </div>
    </div>
</div>

<!-- tabs start -->
<div class="ui-layout-center">


    <div class="panel blank-panel">

        <div class="panel-heading" style="background-image: url('/static/resource/img/head_bg.png')">
            <div class="panel-options">

                <ul class="nav nav-tabs">

                    <li class="active" title="设备信息">
                        <a data-toggle="tab" href="tabs_panels.html#tab-0"><i class="fa fa-desktop"></i>&nbsp;&nbsp;设备</a>
                    </li>

                    <li class="" title="网关信息">
                        <a data-toggle="tab" href="tabs_panels.html#tab-1"><i class="fa fa-sitemap"></i>&nbsp;&nbsp;网关</a>
                    </li>

                </ul>
            </div>
        </div>

        <div class="panel-body" style="padding: 0">
            <div class="tab-content">

                <!-- tab0 start -->
                <div id="tab-0" class="tab-pane active" style="width: 100%;height: 800px">
                    <iframe id="iframe0" src="/iot_dev/device/preListDevice?deptId={{.deptId}}&nodeType=11,12" style="border:none;width: 100%;height: 100%;"></iframe>
                </div>
                <!-- tab0 end -->

                <!-- tab1 start -->
                <div id="tab-1" class="tab-pane" style="width: 100%;height: 800px">
                    <iframe id="iframe1" src="/iot_dev/device/preListGateway?deptId={{.deptId}}&nodeType=10" style="border:none;width: 100%;height: 100%;"></iframe>
                </div>
                <!-- tab1 end -->

            </div>
        </div>
    </div>

</div>
<!-- tabs end -->

{{template "footer" (OssUrl)}}
<script src="{{OssUrl}}/resource/ajax/libs/suggest/bootstrap-suggest.min.js"></script>
<script src="{{OssUrl}}/resource/ajax/libs/jquery-layout/jquery.layout-latest.js"></script>
<script src="{{OssUrl}}/resource/ajax/libs/jquery-ztree/3.5/js/jquery.ztree.all-3.5.js"></script>
<script type="text/javascript">
    var editFlag = '{{hasPermi .uid "system:user:edit"}}';
    var removeFlag = '{{hasPermi .uid "system:user:remove"}}';
    var resetPwdFlag = '{{hasPermi .uid "system:user:resetPwd"}}';
    var prefix = ctx + "/system/user";

    $(function () {
        let panelHidden = false;
        if ($(this).width() < 769) {
            panelHidden = true;
        }
        $('body').layout({initClosed: panelHidden, west__size: 185});
        queryDeptTree();
    });


    function queryDeptTree() {
        let url = ctx + "/system/dept/treeData";
        let options = {
            url: url,
            expandLevel: 2,
            onClick: function (event, treeId, treeNode) { // 点击节点事件
                console.log("-----节点类型-------- treeNode.nodeType:",treeNode.nodeType )
                document.getElementById('iframe0').src = '/iot_dev/device/preListDevice?nodeType=11,12&deptId='+treeNode.id ;
                document.getElementById('iframe1').src = '/iot_dev/device/preListGateway?nodeType=10&deptId='+treeNode.id;
            }
        }
        $.tree.init(options)
    }

    $('#btnExpand').click(function () {
        $._tree.expandAll(true);
        $(this).hide();
        $('#btnCollapse').show();
    });

    $('#btnCollapse').click(function () {
        $._tree.expandAll(false);
        $(this).hide();
        $('#btnExpand').show();
    });

    $('#btnRefresh').click(function () {
        queryDeptTree();
    });

    /* 用户管理-部门 */
    function dept() {
        var url = ctx + "/system/dept";
        $.modal.openTab("部门管理", url);
    }


</script>
<script>
    function preDeviceDetailTabs(title,url){
        $.modal.openTab(title ,url);
    }
</script>
</body>
</html>
